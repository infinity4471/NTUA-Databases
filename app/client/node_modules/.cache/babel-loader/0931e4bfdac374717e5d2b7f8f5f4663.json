{"ast":null,"code":"/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\nimport { createPromise } from \"../util\";\nimport { parseColor as utils_parseColor, saveAs as util_saveAs, support } from \"../common\";\nimport * as PDF from \"./core\";\nimport { Group, MultiPath, Gradient, RadialGradient } from '../drawing';\nimport * as geo from \"../geometry\";\nvar TEXT_RENDERING_MODE = PDF.TEXT_RENDERING_MODE;\nvar DASH_PATTERNS = {\n  dash: [4],\n  dashDot: [4, 2, 1, 2],\n  dot: [1, 2],\n  longDash: [8, 2],\n  longDashDot: [8, 2, 1, 2],\n  longDashDotDot: [8, 2, 1, 2, 1, 2],\n  solid: []\n};\nvar LINE_CAP = {\n  butt: 0,\n  round: 1,\n  square: 2\n};\nvar LINE_JOIN = {\n  miter: 0,\n  round: 1,\n  bevel: 2\n};\n\nfunction render(group, callback) {\n  var fonts = [],\n      images = {},\n      options = group.options;\n\n  function getOption(name, defval, hash) {\n    if (!hash) {\n      hash = options;\n    }\n\n    if (hash.pdf && hash.pdf[name] != null) {\n      return hash.pdf[name];\n    }\n\n    return defval;\n  }\n\n  var multiPage = getOption(\"multiPage\");\n  var imgDPI = getOption(\"imgDPI\");\n\n  if (imgDPI) {\n    PDF.clearImageCache();\n  }\n\n  group.traverse(function (element) {\n    dispatch({\n      Image: function (element) {\n        var url = element.src();\n\n        if (imgDPI) {\n          var box = element.bbox().size;\n          var prev = images[url];\n          box = {\n            width: Math.ceil(box.width * imgDPI / 72),\n            height: Math.ceil(box.height * imgDPI / 72)\n          };\n\n          if (prev) {\n            box.width = Math.max(prev.width, box.width);\n            box.height = Math.max(prev.height, box.height);\n          }\n\n          images[url] = box;\n        } else {\n          images[url] = null;\n        }\n      },\n      Text: function (element) {\n        var style = PDF.parseFontDef(element.options.font);\n        var url = PDF.getFontURL(style);\n\n        if (fonts.indexOf(url) < 0) {\n          fonts.push(url);\n        }\n      }\n    }, element);\n  });\n\n  function doIt() {\n    if (--count > 0) {\n      return;\n    }\n\n    var pdf = new PDF.Document({\n      producer: getOption(\"producer\"),\n      title: getOption(\"title\"),\n      author: getOption(\"author\"),\n      subject: getOption(\"subject\"),\n      keywords: getOption(\"keywords\"),\n      creator: getOption(\"creator\"),\n      date: getOption(\"date\"),\n      autoPrint: getOption(\"autoPrint\")\n    });\n\n    function drawPage(group) {\n      var options = group.options;\n      var tmp = optimize(group);\n      var bbox = tmp.bbox;\n      group = tmp.root; // var tmp, bbox;\n\n      var paperSize = getOption(\"paperSize\", getOption(\"paperSize\", \"auto\"), options),\n          addMargin = false;\n\n      if (paperSize == \"auto\") {\n        if (bbox) {\n          var size = bbox.getSize();\n          paperSize = [size.width, size.height];\n          addMargin = true;\n          var origin = bbox.getOrigin();\n          tmp = new Group();\n          tmp.transform(new geo.Matrix(1, 0, 0, 1, -origin.x, -origin.y));\n          tmp.append(group);\n          group = tmp;\n        } else {\n          paperSize = \"A4\";\n        }\n      }\n\n      var page;\n      page = pdf.addPage({\n        paperSize: paperSize,\n        margin: getOption(\"margin\", getOption(\"margin\"), options),\n        addMargin: addMargin,\n        landscape: getOption(\"landscape\", getOption(\"landscape\", false), options)\n      });\n      drawElement(group, page, pdf);\n    }\n\n    if (multiPage) {\n      group.children.forEach(drawPage);\n    } else {\n      drawPage(group);\n    }\n\n    callback(pdf.render(), pdf);\n  }\n\n  var count = 2;\n  PDF.loadFonts(fonts, doIt);\n  PDF.loadImages(images, doIt);\n}\n\nfunction toDataURL(group, callback) {\n  render(group, function (data) {\n    callback(\"data:application/pdf;base64,\" + data.base64());\n  });\n}\n\nfunction toBlob(group, callback) {\n  render(group, function (data) {\n    callback(new window.Blob([data.get()], {\n      type: \"application/pdf\"\n    }));\n  });\n}\n\nfunction saveAs(group, filename, proxy, callback) {\n  // XXX: Safari has Blob, but does not support the download attribute\n  //      so we'd end up converting to dataURL and using the proxy anyway.\n  if (window.Blob && !support.browser.safari) {\n    toBlob(group, function (blob) {\n      util_saveAs({\n        dataURI: blob,\n        fileName: filename\n      });\n\n      if (callback) {\n        callback(blob);\n      }\n    });\n  } else {\n    toDataURL(group, function (dataURL) {\n      util_saveAs({\n        dataURI: dataURL,\n        fileName: filename,\n        proxyURL: proxy\n      });\n\n      if (callback) {\n        callback(dataURL);\n      }\n    });\n  }\n}\n\nfunction dispatch(handlers, element) {\n  var handler = handlers[element.nodeType];\n\n  if (handler) {\n    return handler.call.apply(handler, arguments);\n  }\n\n  return element;\n}\n\nfunction drawElement(element, page, pdf) {\n  if (element.options._pdfDebug) {\n    page.comment(\"BEGIN: \" + element.options._pdfDebug);\n  }\n\n  var transform = element.transform();\n  var opacity = element.opacity();\n  page.save();\n\n  if (opacity != null && opacity < 1) {\n    page.setOpacity(opacity);\n  }\n\n  setStrokeOptions(element, page, pdf);\n  setFillOptions(element, page, pdf);\n\n  if (transform) {\n    var m = transform.matrix();\n    page.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n  }\n\n  setClipping(element, page, pdf);\n  dispatch({\n    Path: drawPath,\n    MultiPath: drawMultiPath,\n    Circle: drawCircle,\n    Arc: drawArc,\n    Text: drawText,\n    Image: drawImage,\n    Group: drawGroup,\n    Rect: drawRect\n  }, element, page, pdf);\n  page.restore();\n\n  if (element.options._pdfDebug) {\n    page.comment(\"END: \" + element.options._pdfDebug);\n  }\n}\n\nfunction setStrokeOptions(element, page) {\n  var stroke = element.stroke && element.stroke();\n\n  if (!stroke) {\n    return;\n  }\n\n  var color = stroke.color;\n\n  if (color) {\n    color = parseColor(color);\n\n    if (color == null) {\n      return; // no stroke\n    }\n\n    page.setStrokeColor(color.r, color.g, color.b);\n\n    if (color.a != 1) {\n      page.setStrokeOpacity(color.a);\n    }\n  }\n\n  var width = stroke.width;\n\n  if (width != null) {\n    if (width === 0) {\n      return; // no stroke\n    }\n\n    page.setLineWidth(width);\n  }\n\n  var dashType = stroke.dashType;\n\n  if (dashType) {\n    page.setDashPattern(DASH_PATTERNS[dashType], 0);\n  }\n\n  var lineCap = stroke.lineCap;\n\n  if (lineCap) {\n    page.setLineCap(LINE_CAP[lineCap]);\n  }\n\n  var lineJoin = stroke.lineJoin;\n\n  if (lineJoin) {\n    page.setLineJoin(LINE_JOIN[lineJoin]);\n  }\n\n  var opacity = stroke.opacity;\n\n  if (opacity != null) {\n    page.setStrokeOpacity(opacity);\n  }\n}\n\nfunction setFillOptions(element, page) {\n  var fill = element.fill && element.fill();\n\n  if (!fill) {\n    return;\n  }\n\n  if (fill instanceof Gradient) {\n    return;\n  }\n\n  var color = fill.color;\n\n  if (color) {\n    color = parseColor(color);\n\n    if (color == null) {\n      return; // no fill\n    }\n\n    page.setFillColor(color.r, color.g, color.b);\n\n    if (color.a != 1) {\n      page.setFillOpacity(color.a);\n    }\n  }\n\n  var opacity = fill.opacity;\n\n  if (opacity != null) {\n    page.setFillOpacity(opacity);\n  }\n}\n\nfunction setClipping(element, page, pdf) {\n  // XXX: only Path supported at the moment.\n  var clip = element.clip();\n\n  if (clip) {\n    _drawPath(clip, page, pdf);\n\n    page.clip(); // page.setStrokeColor(Math.random(), Math.random(), Math.random());\n    // page.setLineWidth(1);\n    // page.stroke();\n  }\n}\n\nfunction shouldDraw(thing) {\n  return thing && (thing instanceof Gradient || thing.color && !/^(none|transparent)$/i.test(thing.color) && (thing.width == null || thing.width > 0) && (thing.opacity == null || thing.opacity > 0));\n}\n\nfunction maybeGradient(element, page, pdf, stroke) {\n  var fill = element.fill();\n\n  if (fill instanceof Gradient) {\n    if (stroke) {\n      page.clipStroke();\n    } else {\n      page.clip();\n    }\n\n    var isRadial = fill instanceof RadialGradient;\n    var start, end;\n\n    if (isRadial) {\n      start = {\n        x: fill.center().x,\n        y: fill.center().y,\n        r: 0\n      };\n      end = {\n        x: fill.center().x,\n        y: fill.center().y,\n        r: fill.radius()\n      };\n    } else {\n      start = {\n        x: fill.start().x,\n        y: fill.start().y\n      };\n      end = {\n        x: fill.end().x,\n        y: fill.end().y\n      };\n    }\n\n    var stops = fill.stops.elements().map(function (stop) {\n      var offset = stop.offset();\n\n      if (/%$/.test(offset)) {\n        offset = parseFloat(offset) / 100;\n      } else {\n        offset = parseFloat(offset);\n      }\n\n      var color = parseColor(stop.color());\n      color.a *= stop.opacity();\n      return {\n        offset: offset,\n        color: color\n      };\n    }); // Duplicats first and last stop to fix\n    // https://github.com/telerik/kendo-ui-core/issues/1782\n\n    stops.unshift(stops[0]);\n    stops.push(stops[stops.length - 1]);\n    var gradient = {\n      userSpace: fill.userSpace(),\n      type: isRadial ? \"radial\" : \"linear\",\n      start: start,\n      end: end,\n      stops: stops\n    };\n    var box = element.rawBBox();\n    var tl = box.topLeft(),\n        size = box.getSize();\n    box = {\n      left: tl.x,\n      top: tl.y,\n      width: size.width,\n      height: size.height\n    };\n    page.gradient(gradient, box);\n    return true;\n  }\n}\n\nfunction maybeFillStroke(element, page, pdf) {\n  if (shouldDraw(element.fill()) && shouldDraw(element.stroke())) {\n    if (!maybeGradient(element, page, pdf, true)) {\n      page.fillStroke();\n    }\n  } else if (shouldDraw(element.fill())) {\n    if (!maybeGradient(element, page, pdf, false)) {\n      page.fill();\n    }\n  } else if (shouldDraw(element.stroke())) {\n    page.stroke();\n  } else {\n    // we should not get here; the path should have been\n    // optimized away.  but let's be prepared.\n    page.nop();\n  }\n}\n\nfunction maybeDrawRect(path, page) {\n  var segments = path.segments;\n\n  if (segments.length == 4 && path.options.closed) {\n    // detect if this path looks like a rectangle parallel to the axis\n    var a = [];\n\n    for (var i = 0; i < segments.length; ++i) {\n      if (segments[i].controlIn()) {\n        // has curve?\n        return false;\n      }\n\n      a[i] = segments[i].anchor();\n    } // it's a rectangle if the y/x/y/x or x/y/x/y coords of\n    // consecutive points are the same.\n\n\n    var isRect = a[0].y == a[1].y && a[1].x == a[2].x && a[2].y == a[3].y && a[3].x == a[0].x || a[0].x == a[1].x && a[1].y == a[2].y && a[2].x == a[3].x && a[3].y == a[0].y;\n\n    if (isRect) {\n      // this saves a bunch of instructions in PDF:\n      // moveTo, lineTo, lineTo, lineTo, close -> rect.\n      page.rect(a[0].x, a[0].y, a[2].x - a[0].x\n      /*width*/\n      , a[2].y - a[0].y\n      /*height*/\n      );\n      return true;\n    }\n  }\n}\n\nfunction _drawPath(element, page, pdf) {\n  var segments = element.segments;\n\n  if (segments.length === 0) {\n    return;\n  }\n\n  if (!maybeDrawRect(element, page, pdf)) {\n    for (var prev, i = 0; i < segments.length; ++i) {\n      var seg = segments[i];\n      var anchor = seg.anchor();\n\n      if (!prev) {\n        page.moveTo(anchor.x, anchor.y);\n      } else {\n        var prevOut = prev.controlOut();\n        var controlIn = seg.controlIn();\n\n        if (prevOut && controlIn) {\n          page.bezier(prevOut.x, prevOut.y, controlIn.x, controlIn.y, anchor.x, anchor.y);\n        } else {\n          page.lineTo(anchor.x, anchor.y);\n        }\n      }\n\n      prev = seg;\n    }\n\n    if (element.options.closed) {\n      page.close();\n    }\n  }\n}\n\nfunction drawPath(element, page, pdf) {\n  _drawPath(element, page, pdf);\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawMultiPath(element, page, pdf) {\n  var paths = element.paths;\n\n  for (var i = 0; i < paths.length; ++i) {\n    _drawPath(paths[i], page, pdf);\n  }\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawCircle(element, page, pdf) {\n  var g = element.geometry();\n  page.circle(g.center.x, g.center.y, g.radius);\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawArc(element, page, pdf) {\n  var points = element.geometry().curvePoints();\n  page.moveTo(points[0].x, points[0].y);\n\n  for (var i = 1; i < points.length;) {\n    page.bezier(points[i].x, points[i++].y, points[i].x, points[i++].y, points[i].x, points[i++].y);\n  }\n\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction drawText(element, page) {\n  var style = PDF.parseFontDef(element.options.font);\n  var pos = element._position;\n  var mode;\n\n  if (element.fill() && element.stroke()) {\n    mode = TEXT_RENDERING_MODE.fillAndStroke;\n  } else if (element.fill()) {\n    mode = TEXT_RENDERING_MODE.fill;\n  } else if (element.stroke()) {\n    mode = TEXT_RENDERING_MODE.stroke;\n  }\n\n  page.transform(1, 0, 0, -1, pos.x, pos.y + style.fontSize);\n  page.beginText();\n  page.setFont(PDF.getFontURL(style), style.fontSize);\n  page.setTextRenderingMode(mode);\n  page.showText(element.content(), element._pdfRect ? element._pdfRect.width() : null);\n  page.endText();\n}\n\nfunction drawGroup(element, page, pdf) {\n  if (element._pdfLink) {\n    page.addLink(element._pdfLink.url, element._pdfLink);\n  }\n\n  var children = element.children;\n\n  for (var i = 0; i < children.length; ++i) {\n    drawElement(children[i], page, pdf);\n  }\n}\n\nfunction drawImage(element, page) {\n  var url = element.src();\n\n  if (!url) {\n    return;\n  }\n\n  var rect = element.rect();\n  var tl = rect.getOrigin();\n  var sz = rect.getSize();\n  page.transform(sz.width, 0, 0, -sz.height, tl.x, tl.y + sz.height);\n  page.drawImage(url);\n}\n\nfunction drawRect(element, page, pdf) {\n  var geometry = element.geometry();\n  page.rect(geometry.origin.x, geometry.origin.y, geometry.size.width, geometry.size.height);\n  maybeFillStroke(element, page, pdf);\n}\n\nfunction parseColor(value) {\n  var color = utils_parseColor(value, true);\n  return color ? color.toRGB() : null;\n}\n\nfunction optimize(root) {\n  var clipbox = false;\n  var matrix = geo.Matrix.unit();\n  var currentBox = null;\n  var changed;\n\n  do {\n    changed = false;\n    root = opt(root);\n  } while (root && changed);\n\n  return {\n    root: root,\n    bbox: currentBox\n  };\n\n  function change(newShape) {\n    changed = true;\n    return newShape;\n  }\n\n  function visible(shape) {\n    return shape.visible() && shape.opacity() > 0 && (shouldDraw(shape.fill()) || shouldDraw(shape.stroke()));\n  }\n\n  function optArray(a) {\n    var b = [];\n\n    for (var i = 0; i < a.length; ++i) {\n      var el = opt(a[i]);\n\n      if (el != null) {\n        b.push(el);\n      }\n    }\n\n    return b;\n  }\n\n  function withClipping(shape, f) {\n    var saveclipbox = clipbox;\n    var savematrix = matrix;\n\n    if (shape.transform()) {\n      matrix = matrix.multiplyCopy(shape.transform().matrix());\n    }\n\n    var clip = shape.clip();\n\n    if (clip) {\n      clip = clip.bbox();\n\n      if (clip) {\n        clip = clip.bbox(matrix);\n        clipbox = clipbox ? geo.Rect.intersect(clipbox, clip) : clip;\n      }\n    }\n\n    try {\n      return f();\n    } finally {\n      clipbox = saveclipbox;\n      matrix = savematrix;\n    }\n  }\n\n  function inClipbox(shape) {\n    if (clipbox == null) {\n      return false;\n    }\n\n    var box = shape.rawBBox().bbox(matrix);\n\n    if (clipbox && box) {\n      box = geo.Rect.intersect(box, clipbox);\n    }\n\n    return box;\n  }\n\n  function opt(shape) {\n    return withClipping(shape, function () {\n      if (!(shape instanceof Group || shape instanceof MultiPath)) {\n        var box = inClipbox(shape);\n\n        if (!box) {\n          return change(null);\n        }\n\n        currentBox = currentBox ? geo.Rect.union(currentBox, box) : box;\n      }\n\n      return dispatch({\n        Path: function (shape) {\n          if (shape.segments.length === 0 || !visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        MultiPath: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          var el = new MultiPath(shape.options);\n          el.paths = optArray(shape.paths);\n\n          if (el.paths.length === 0) {\n            return change(null);\n          }\n\n          return el;\n        },\n        Circle: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Arc: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Text: function (shape) {\n          if (!/\\S/.test(shape.content()) || !visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Image: function (shape) {\n          if (!(shape.visible() && shape.opacity() > 0)) {\n            return change(null);\n          }\n\n          return shape;\n        },\n        Group: function (shape) {\n          if (!(shape.visible() && shape.opacity() > 0)) {\n            return change(null);\n          }\n\n          var el = new Group(shape.options);\n          el.children = optArray(shape.children);\n          el._pdfLink = shape._pdfLink;\n\n          if (shape !== root && el.children.length === 0 && !shape._pdfLink) {\n            return change(null);\n          }\n\n          return el;\n        },\n        Rect: function (shape) {\n          if (!visible(shape)) {\n            return change(null);\n          }\n\n          return shape;\n        }\n      }, shape);\n    });\n  }\n}\n\nfunction exportPDF(group, options) {\n  var promise = createPromise();\n\n  for (var i in options) {\n    if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n      // This hackish option is set by the page breaking code in drawDOM.  The idea is\n      // that margin is already taken into account there (that's required to do proper\n      // page breaking) and we don't want to set it again here, as it would double the\n      // top-left margin, and truncate the content on bottom/right.\n      continue;\n    }\n\n    group.options.set(\"pdf.\" + i, options[i]);\n  }\n\n  toDataURL(group, promise.resolve);\n  return promise;\n}\n\nexport { exportPDF, saveAs, toDataURL, toBlob, render };","map":{"version":3,"sources":["/home/infinity/Desktop/supermarket/NTUA-Databases/app/client/node_modules/@progress/kendo-drawing/dist/es/pdf/drawing.js"],"names":["createPromise","parseColor","utils_parseColor","saveAs","util_saveAs","support","PDF","Group","MultiPath","Gradient","RadialGradient","geo","TEXT_RENDERING_MODE","DASH_PATTERNS","dash","dashDot","dot","longDash","longDashDot","longDashDotDot","solid","LINE_CAP","butt","round","square","LINE_JOIN","miter","bevel","render","group","callback","fonts","images","options","getOption","name","defval","hash","pdf","multiPage","imgDPI","clearImageCache","traverse","element","dispatch","Image","url","src","box","bbox","size","prev","width","Math","ceil","height","max","Text","style","parseFontDef","font","getFontURL","indexOf","push","doIt","count","Document","producer","title","author","subject","keywords","creator","date","autoPrint","drawPage","tmp","optimize","root","paperSize","addMargin","getSize","origin","getOrigin","transform","Matrix","x","y","append","page","addPage","margin","landscape","drawElement","children","forEach","loadFonts","loadImages","toDataURL","data","base64","toBlob","window","Blob","get","type","filename","proxy","browser","safari","blob","dataURI","fileName","dataURL","proxyURL","handlers","handler","nodeType","call","apply","arguments","_pdfDebug","comment","opacity","save","setOpacity","setStrokeOptions","setFillOptions","m","matrix","a","b","c","d","e","f","setClipping","Path","drawPath","drawMultiPath","Circle","drawCircle","Arc","drawArc","drawText","drawImage","drawGroup","Rect","drawRect","restore","stroke","color","setStrokeColor","r","g","setStrokeOpacity","setLineWidth","dashType","setDashPattern","lineCap","setLineCap","lineJoin","setLineJoin","fill","setFillColor","setFillOpacity","clip","_drawPath","shouldDraw","thing","test","maybeGradient","clipStroke","isRadial","start","end","center","radius","stops","elements","map","stop","offset","parseFloat","unshift","length","gradient","userSpace","rawBBox","tl","topLeft","left","top","maybeFillStroke","fillStroke","nop","maybeDrawRect","path","segments","closed","i","controlIn","anchor","isRect","rect","seg","moveTo","prevOut","controlOut","bezier","lineTo","close","paths","geometry","circle","points","curvePoints","pos","_position","mode","fillAndStroke","fontSize","beginText","setFont","setTextRenderingMode","showText","content","_pdfRect","endText","_pdfLink","addLink","sz","value","toRGB","clipbox","unit","currentBox","changed","opt","change","newShape","visible","shape","optArray","el","withClipping","saveclipbox","savematrix","multiplyCopy","intersect","inClipbox","union","exportPDF","promise","_ignoreMargin","set","resolve"],"mappings":"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","sourcesContent":["/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { createPromise } from \"../util\";\nimport { parseColor as utils_parseColor, saveAs as util_saveAs, support } from \"../common\";\nimport * as PDF from \"./core\";\nimport { Group, MultiPath, Gradient, RadialGradient } from '../drawing';\nimport * as geo from \"../geometry\";\n\nvar TEXT_RENDERING_MODE = PDF.TEXT_RENDERING_MODE;\n\nvar DASH_PATTERNS = {\n    dash           : [ 4 ],\n    dashDot        : [ 4, 2, 1, 2 ],\n    dot            : [ 1, 2 ],\n    longDash       : [ 8, 2 ],\n    longDashDot    : [ 8, 2, 1, 2 ],\n    longDashDotDot : [ 8, 2, 1, 2, 1, 2 ],\n    solid          : []\n};\n\nvar LINE_CAP = {\n    butt   : 0,\n    round  : 1,\n    square : 2\n};\n\nvar LINE_JOIN = {\n    miter : 0,\n    round : 1,\n    bevel : 2\n};\n\nfunction render(group, callback) {\n    var fonts = [], images = {}, options = group.options;\n\n    function getOption(name, defval, hash) {\n        if (!hash) {\n            hash = options;\n        }\n        if (hash.pdf && hash.pdf[name] != null) {\n            return hash.pdf[name];\n        }\n        return defval;\n    }\n\n    var multiPage = getOption(\"multiPage\");\n    var imgDPI = getOption(\"imgDPI\");\n\n    if (imgDPI) {\n        PDF.clearImageCache();\n    }\n\n    group.traverse(function(element){\n        dispatch({\n            Image: function(element) {\n                var url = element.src();\n                if (imgDPI) {\n                    var box = element.bbox().size;\n                    var prev = images[url];\n                    box = {\n                        width: Math.ceil(box.width * imgDPI / 72),\n                        height: Math.ceil(box.height * imgDPI / 72)\n                    };\n                    if (prev) {\n                        box.width = Math.max(prev.width, box.width);\n                        box.height = Math.max(prev.height, box.height);\n                    }\n                    images[url] = box;\n                } else {\n                    images[url] = null;\n                }\n            },\n            Text: function(element) {\n                var style = PDF.parseFontDef(element.options.font);\n                var url = PDF.getFontURL(style);\n                if (fonts.indexOf(url) < 0) {\n                    fonts.push(url);\n                }\n            }\n        }, element);\n    });\n\n    function doIt() {\n        if (--count > 0) {\n            return;\n        }\n\n        var pdf = new (PDF.Document)({\n            producer  : getOption(\"producer\"),\n            title     : getOption(\"title\"),\n            author    : getOption(\"author\"),\n            subject   : getOption(\"subject\"),\n            keywords  : getOption(\"keywords\"),\n            creator   : getOption(\"creator\"),\n            date      : getOption(\"date\"),\n\n            autoPrint : getOption(\"autoPrint\")\n        });\n\n        function drawPage(group) {\n            var options = group.options;\n\n            var tmp = optimize(group);\n            var bbox = tmp.bbox;\n            group = tmp.root;\n            // var tmp, bbox;\n\n            var paperSize = getOption(\"paperSize\", getOption(\"paperSize\", \"auto\"), options), addMargin = false;\n            if (paperSize == \"auto\") {\n                if (bbox) {\n                    var size = bbox.getSize();\n                    paperSize = [ size.width, size.height ];\n                    addMargin = true;\n                    var origin = bbox.getOrigin();\n                    tmp = new Group();\n                    tmp.transform(new geo.Matrix(1, 0, 0, 1, -origin.x, -origin.y));\n                    tmp.append(group);\n                    group = tmp;\n                }\n                else {\n                    paperSize = \"A4\";\n                }\n            }\n\n            var page;\n            page = pdf.addPage({\n                paperSize : paperSize,\n                margin    : getOption(\"margin\", getOption(\"margin\"), options),\n                addMargin : addMargin,\n                landscape : getOption(\"landscape\", getOption(\"landscape\", false), options)\n            });\n            drawElement(group, page, pdf);\n        }\n\n        if (multiPage) {\n            group.children.forEach(drawPage);\n        } else {\n            drawPage(group);\n        }\n\n        callback(pdf.render(), pdf);\n    }\n\n    var count = 2;\n    PDF.loadFonts(fonts, doIt);\n    PDF.loadImages(images, doIt);\n}\n\nfunction toDataURL(group, callback) {\n    render(group, function(data){\n        callback(\"data:application/pdf;base64,\" + data.base64());\n    });\n}\n\nfunction toBlob(group, callback) {\n    render(group, function(data){\n        callback(new window.Blob([ data.get() ], { type: \"application/pdf\" }));\n    });\n}\n\nfunction saveAs(group, filename, proxy, callback) {\n    // XXX: Safari has Blob, but does not support the download attribute\n    //      so we'd end up converting to dataURL and using the proxy anyway.\n    if (window.Blob && !support.browser.safari) {\n        toBlob(group, function(blob){\n            util_saveAs({ dataURI: blob, fileName: filename });\n            if (callback) {\n                callback(blob);\n            }\n        });\n    } else {\n        toDataURL(group, function(dataURL){\n            util_saveAs({ dataURI: dataURL, fileName: filename, proxyURL: proxy });\n            if (callback) {\n                callback(dataURL);\n            }\n        });\n    }\n}\n\nfunction dispatch(handlers, element) {\n    var handler = handlers[element.nodeType];\n    if (handler) {\n        return handler.call.apply(handler, arguments);\n    }\n    return element;\n}\n\nfunction drawElement(element, page, pdf) {\n    if (element.options._pdfDebug) {\n        page.comment(\"BEGIN: \" + element.options._pdfDebug);\n    }\n\n    var transform = element.transform();\n    var opacity = element.opacity();\n\n    page.save();\n\n    if (opacity != null && opacity < 1) {\n        page.setOpacity(opacity);\n    }\n\n    setStrokeOptions(element, page, pdf);\n    setFillOptions(element, page, pdf);\n\n    if (transform) {\n        var m = transform.matrix();\n        page.transform(m.a, m.b, m.c, m.d, m.e, m.f);\n    }\n\n    setClipping(element, page, pdf);\n\n    dispatch({\n        Path      : drawPath,\n        MultiPath : drawMultiPath,\n        Circle    : drawCircle,\n        Arc       : drawArc,\n        Text      : drawText,\n        Image     : drawImage,\n        Group     : drawGroup,\n        Rect      : drawRect\n    }, element, page, pdf);\n\n    page.restore();\n\n    if (element.options._pdfDebug) {\n        page.comment(\"END: \" + element.options._pdfDebug);\n    }\n}\n\nfunction setStrokeOptions(element, page) {\n    var stroke = element.stroke && element.stroke();\n    if (!stroke) {\n        return;\n    }\n\n    var color = stroke.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no stroke\n        }\n        page.setStrokeColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setStrokeOpacity(color.a);\n        }\n    }\n\n    var width = stroke.width;\n    if (width != null) {\n        if (width === 0) {\n            return; // no stroke\n        }\n        page.setLineWidth(width);\n    }\n\n    var dashType = stroke.dashType;\n    if (dashType) {\n        page.setDashPattern(DASH_PATTERNS[dashType], 0);\n    }\n\n    var lineCap = stroke.lineCap;\n    if (lineCap) {\n        page.setLineCap(LINE_CAP[lineCap]);\n    }\n\n    var lineJoin = stroke.lineJoin;\n    if (lineJoin) {\n        page.setLineJoin(LINE_JOIN[lineJoin]);\n    }\n\n    var opacity = stroke.opacity;\n    if (opacity != null) {\n        page.setStrokeOpacity(opacity);\n    }\n}\n\nfunction setFillOptions(element, page) {\n    var fill = element.fill && element.fill();\n    if (!fill) {\n        return;\n    }\n\n    if (fill instanceof Gradient) {\n        return;\n    }\n\n    var color = fill.color;\n    if (color) {\n        color = parseColor(color);\n        if (color == null) {\n            return; // no fill\n        }\n        page.setFillColor(color.r, color.g, color.b);\n        if (color.a != 1) {\n            page.setFillOpacity(color.a);\n        }\n    }\n\n    var opacity = fill.opacity;\n    if (opacity != null) {\n        page.setFillOpacity(opacity);\n    }\n}\n\nfunction setClipping(element, page, pdf) {\n    // XXX: only Path supported at the moment.\n    var clip = element.clip();\n    if (clip) {\n        _drawPath(clip, page, pdf);\n        page.clip();\n        // page.setStrokeColor(Math.random(), Math.random(), Math.random());\n        // page.setLineWidth(1);\n        // page.stroke();\n    }\n}\n\nfunction shouldDraw(thing) {\n    return (thing &&\n            (thing instanceof Gradient ||\n             (thing.color && !/^(none|transparent)$/i.test(thing.color) &&\n              (thing.width == null || thing.width > 0) &&\n              (thing.opacity == null || thing.opacity > 0))));\n}\n\nfunction maybeGradient(element, page, pdf, stroke) {\n    var fill = element.fill();\n    if (fill instanceof Gradient) {\n        if (stroke) {\n            page.clipStroke();\n        } else {\n            page.clip();\n        }\n        var isRadial = fill instanceof RadialGradient;\n        var start, end;\n        if (isRadial) {\n            start = { x: fill.center().x , y: fill.center().y , r: 0 };\n            end   = { x: fill.center().x , y: fill.center().y , r: fill.radius() };\n        } else {\n            start = { x: fill.start().x , y: fill.start().y };\n            end   = { x: fill.end().x   , y: fill.end().y   };\n        }\n\n        var stops = fill.stops.elements().map(function(stop){\n            var offset = stop.offset();\n            if (/%$/.test(offset)) {\n                offset = parseFloat(offset) / 100;\n            } else {\n                offset = parseFloat(offset);\n            }\n            var color = parseColor(stop.color());\n            color.a *= stop.opacity();\n            return {\n                offset: offset,\n                color: color\n            };\n        });\n\n        // Duplicats first and last stop to fix\n        // https://github.com/telerik/kendo-ui-core/issues/1782\n        stops.unshift(stops[0]);\n        stops.push(stops[stops.length - 1]);\n\n        var gradient = {\n            userSpace : fill.userSpace(),\n            type      : isRadial ? \"radial\" : \"linear\",\n            start     : start,\n            end       : end,\n            stops     : stops\n        };\n        var box = element.rawBBox();\n        var tl = box.topLeft(), size = box.getSize();\n        box = {\n            left   : tl.x,\n            top    : tl.y,\n            width  : size.width,\n            height : size.height\n        };\n        page.gradient(gradient, box);\n        return true;\n    }\n}\n\nfunction maybeFillStroke(element, page, pdf) {\n    if (shouldDraw(element.fill()) && shouldDraw(element.stroke())) {\n        if (!maybeGradient(element, page, pdf, true)) {\n            page.fillStroke();\n        }\n    } else if (shouldDraw(element.fill())) {\n        if (!maybeGradient(element, page, pdf, false)) {\n            page.fill();\n        }\n    } else if (shouldDraw(element.stroke())) {\n        page.stroke();\n    } else {\n        // we should not get here; the path should have been\n        // optimized away.  but let's be prepared.\n        page.nop();\n    }\n}\n\nfunction maybeDrawRect(path, page) {\n    var segments = path.segments;\n    if (segments.length == 4 && path.options.closed) {\n        // detect if this path looks like a rectangle parallel to the axis\n        var a = [];\n        for (var i = 0; i < segments.length; ++i) {\n            if (segments[i].controlIn()) { // has curve?\n                return false;\n            }\n            a[i] = segments[i].anchor();\n        }\n        // it's a rectangle if the y/x/y/x or x/y/x/y coords of\n        // consecutive points are the same.\n        var isRect = (\n            a[0].y == a[1].y && a[1].x == a[2].x && a[2].y == a[3].y && a[3].x == a[0].x\n        ) || (\n            a[0].x == a[1].x && a[1].y == a[2].y && a[2].x == a[3].x && a[3].y == a[0].y\n        );\n        if (isRect) {\n            // this saves a bunch of instructions in PDF:\n            // moveTo, lineTo, lineTo, lineTo, close -> rect.\n            page.rect(a[0].x, a[0].y,\n                      a[2].x - a[0].x /*width*/,\n                      a[2].y - a[0].y /*height*/);\n            return true;\n        }\n    }\n}\n\nfunction _drawPath(element, page, pdf) {\n    var segments = element.segments;\n    if (segments.length === 0) {\n        return;\n    }\n    if (!maybeDrawRect(element, page, pdf)) {\n        for (var prev, i = 0; i < segments.length; ++i) {\n            var seg = segments[i];\n            var anchor = seg.anchor();\n            if (!prev) {\n                page.moveTo(anchor.x, anchor.y);\n            } else {\n                var prevOut = prev.controlOut();\n                var controlIn = seg.controlIn();\n                if (prevOut && controlIn) {\n                    page.bezier(\n                        prevOut.x   , prevOut.y,\n                        controlIn.x , controlIn.y,\n                        anchor.x    , anchor.y\n                    );\n                } else {\n                    page.lineTo(anchor.x, anchor.y);\n                }\n            }\n            prev = seg;\n        }\n        if (element.options.closed) {\n            page.close();\n        }\n    }\n}\n\nfunction drawPath(element, page, pdf) {\n    _drawPath(element, page, pdf);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawMultiPath(element, page, pdf) {\n    var paths = element.paths;\n    for (var i = 0; i < paths.length; ++i) {\n        _drawPath(paths[i], page, pdf);\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawCircle(element, page, pdf) {\n    var g = element.geometry();\n    page.circle(g.center.x, g.center.y, g.radius);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawArc(element, page, pdf) {\n    var points = element.geometry().curvePoints();\n    page.moveTo(points[0].x, points[0].y);\n    for (var i = 1; i < points.length;) {\n        page.bezier(\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y,\n            points[i].x, points[i++].y\n        );\n    }\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction drawText(element, page) {\n    var style = PDF.parseFontDef(element.options.font);\n    var pos = element._position;\n    var mode;\n    if (element.fill() && element.stroke()) {\n        mode = TEXT_RENDERING_MODE.fillAndStroke;\n    } else if (element.fill()) {\n        mode = TEXT_RENDERING_MODE.fill;\n    } else if (element.stroke()) {\n        mode = TEXT_RENDERING_MODE.stroke;\n    }\n\n    page.transform(1, 0, 0, -1, pos.x, pos.y + style.fontSize);\n    page.beginText();\n    page.setFont(PDF.getFontURL(style), style.fontSize);\n    page.setTextRenderingMode(mode);\n    page.showText(element.content(), element._pdfRect ? element._pdfRect.width() : null);\n    page.endText();\n}\n\nfunction drawGroup(element, page, pdf) {\n    if (element._pdfLink) {\n        page.addLink(element._pdfLink.url, element._pdfLink);\n    }\n    var children = element.children;\n    for (var i = 0; i < children.length; ++i) {\n        drawElement(children[i], page, pdf);\n    }\n}\n\nfunction drawImage(element, page) {\n    var url = element.src();\n    if (!url) {\n        return;\n    }\n\n    var rect = element.rect();\n    var tl = rect.getOrigin();\n    var sz = rect.getSize();\n    page.transform(sz.width, 0, 0, -sz.height, tl.x, tl.y + sz.height);\n    page.drawImage(url);\n}\n\nfunction drawRect(element, page, pdf) {\n    var geometry = element.geometry();\n    page.rect(geometry.origin.x, geometry.origin.y, geometry.size.width, geometry.size.height);\n    maybeFillStroke(element, page, pdf);\n}\n\nfunction parseColor(value) {\n    var color = utils_parseColor(value, true);\n    return color ? color.toRGB() : null;\n}\n\nfunction optimize(root) {\n    var clipbox = false;\n    var matrix = geo.Matrix.unit();\n    var currentBox = null;\n    var changed;\n    do {\n        changed = false;\n        root = opt(root);\n    } while (root && changed);\n    return { root: root, bbox: currentBox };\n\n    function change(newShape) {\n        changed = true;\n        return newShape;\n    }\n\n    function visible(shape) {\n        return (shape.visible() && shape.opacity() > 0 &&\n                ( shouldDraw(shape.fill()) ||\n                  shouldDraw(shape.stroke()) ));\n    }\n\n    function optArray(a) {\n        var b = [];\n        for (var i = 0; i < a.length; ++i) {\n            var el = opt(a[i]);\n            if (el != null) {\n                b.push(el);\n            }\n        }\n        return b;\n    }\n\n    function withClipping(shape, f) {\n        var saveclipbox = clipbox;\n        var savematrix = matrix;\n\n        if (shape.transform()) {\n            matrix = matrix.multiplyCopy(shape.transform().matrix());\n        }\n\n        var clip = shape.clip();\n        if (clip) {\n            clip = clip.bbox();\n            if (clip) {\n                clip = clip.bbox(matrix);\n                clipbox = clipbox ? geo.Rect.intersect(clipbox, clip) : clip;\n            }\n        }\n\n        try {\n            return f();\n        }\n        finally {\n            clipbox = saveclipbox;\n            matrix = savematrix;\n        }\n    }\n\n    function inClipbox(shape) {\n        if (clipbox == null) {\n            return false;\n        }\n        var box = shape.rawBBox().bbox(matrix);\n        if (clipbox && box) {\n            box = geo.Rect.intersect(box, clipbox);\n        }\n        return box;\n    }\n\n    function opt(shape) {\n        return withClipping(shape, function(){\n            if (!(shape instanceof Group || shape instanceof MultiPath)) {\n                var box = inClipbox(shape);\n                if (!box) {\n                    return change(null);\n                }\n                currentBox = currentBox ? geo.Rect.union(currentBox, box) : box;\n            }\n            return dispatch({\n                Path: function(shape) {\n                    if (shape.segments.length === 0 || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                MultiPath: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    var el = new MultiPath(shape.options);\n                    el.paths = optArray(shape.paths);\n                    if (el.paths.length === 0) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Circle: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Arc: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Text: function(shape) {\n                    if (!/\\S/.test(shape.content()) || !visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Image: function(shape) {\n                    if (!(shape.visible() && shape.opacity() > 0)) {\n                        return change(null);\n                    }\n                    return shape;\n                },\n                Group: function(shape) {\n                    if (!(shape.visible() && shape.opacity() > 0)) {\n                        return change(null);\n                    }\n                    var el = new Group(shape.options);\n                    el.children = optArray(shape.children);\n                    el._pdfLink = shape._pdfLink;\n                    if (shape !== root && el.children.length === 0 && !shape._pdfLink) {\n                        return change(null);\n                    }\n                    return el;\n                },\n                Rect: function(shape) {\n                    if (!visible(shape)) {\n                        return change(null);\n                    }\n                    return shape;\n                }\n            }, shape);\n        });\n    }\n}\n\nfunction exportPDF(group, options) {\n    var promise = createPromise();\n\n    for (var i in options) {\n        if (i == \"margin\" && group.options.pdf && group.options.pdf._ignoreMargin) {\n            // This hackish option is set by the page breaking code in drawDOM.  The idea is\n            // that margin is already taken into account there (that's required to do proper\n            // page breaking) and we don't want to set it again here, as it would double the\n            // top-left margin, and truncate the content on bottom/right.\n            continue;\n        }\n        group.options.set(\"pdf.\" + i, options[i]);\n    }\n\n    toDataURL(group, promise.resolve);\n\n    return promise;\n}\n\nexport { exportPDF, saveAs, toDataURL, toBlob, render };\n"]},"metadata":{},"sourceType":"module"}
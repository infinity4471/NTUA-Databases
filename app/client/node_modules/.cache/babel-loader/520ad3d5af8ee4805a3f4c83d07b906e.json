{"ast":null,"code":"var normalize = function (x) {\n  return Math.max(x, 0);\n};\n/**\n * @hidden\n */\n\n\nvar ScrollAction =\n/** @class */\nfunction () {\n  function ScrollAction(offset) {\n    this.offset = offset;\n  }\n\n  return ScrollAction;\n}();\n\nexport { ScrollAction };\n/**\n * @hidden\n */\n\nvar PageAction =\n/** @class */\nfunction () {\n  function PageAction(skip) {\n    this.skip = skip;\n  }\n\n  return PageAction;\n}();\n\nexport { PageAction };\n/**\n * @hidden\n */\n\nvar ScrollerService =\n/** @class */\nfunction () {\n  function ScrollerService(onScrollAction, onPageAction) {\n    this.onScrollAction = onScrollAction;\n    this.onPageAction = onPageAction;\n    this.firstLoaded = 0;\n    this.bottomOffset = 0;\n    this.topOffset = 0;\n  }\n\n  ScrollerService.prototype.create = function (rowHeightService, skip, take, total, topOffset, bottomOffset, direction) {\n    if (topOffset === void 0) {\n      topOffset = 0;\n    }\n\n    if (bottomOffset === void 0) {\n      bottomOffset = 0;\n    }\n\n    if (direction === void 0) {\n      direction = 'vertical';\n    }\n\n    this.rowHeightService = rowHeightService;\n    this.firstLoaded = skip;\n    this.lastLoaded = skip + take;\n    this.take = take;\n    this.total = total;\n    this.lastScrollTop = 0;\n    this.topOffset = topOffset;\n    this.bottomOffset = bottomOffset;\n    this.direction = direction;\n    var offsetBufferRows = this.rowsForHeight(topOffset);\n    var skipWithOffset = normalize(skip - offsetBufferRows);\n    this.onScrollAction(new ScrollAction(this.rowOffset(skipWithOffset)));\n    this.onPageAction(new PageAction(skipWithOffset));\n  };\n\n  ScrollerService.prototype.onScroll = function (_a) {\n    var scrollLeft = _a.scrollLeft,\n        scrollTop = _a.scrollTop,\n        offsetHeight = _a.offsetHeight,\n        offsetWidth = _a.offsetWidth;\n    var scrollPosition = this.direction === 'vertical' ? scrollTop : scrollLeft;\n    var offsetSize = this.direction === 'vertical' ? offsetHeight : offsetWidth;\n\n    if (this.lastScrollTop === scrollPosition) {\n      return;\n    }\n\n    var up = this.lastScrollTop >= scrollPosition;\n    this.lastScrollTop = scrollPosition;\n    var firstItemIndex = this.rowHeightService.index(normalize(scrollPosition - this.topOffset));\n    var lastItemIndex = this.rowHeightService.index(normalize(scrollPosition + offsetSize - this.bottomOffset));\n\n    if (!up && lastItemIndex >= this.lastLoaded && this.lastLoaded < this.total) {\n      this.firstLoaded = firstItemIndex;\n      this.onScrollAction(new ScrollAction(this.rowOffset(firstItemIndex)));\n      this.lastLoaded = Math.min(this.firstLoaded + this.take, this.total);\n      this.onPageAction(new PageAction(this.firstLoaded));\n    }\n\n    if (up && firstItemIndex <= this.firstLoaded) {\n      var nonVisibleBuffer = Math.floor(this.take * 0.3);\n      this.firstLoaded = normalize(firstItemIndex - nonVisibleBuffer);\n      this.onScrollAction(new ScrollAction(this.rowOffset(this.firstLoaded)));\n      this.lastLoaded = Math.min(this.firstLoaded + this.take, this.total);\n      this.onPageAction(new PageAction(this.firstLoaded));\n    }\n  };\n\n  ScrollerService.prototype.rowOffset = function (index) {\n    return this.rowHeightService.offset(index) + this.topOffset;\n  };\n\n  ScrollerService.prototype.rowsForHeight = function (height) {\n    return Math.ceil(height / this.rowHeightService.height(0));\n  };\n\n  return ScrollerService;\n}();\n\nexport { ScrollerService };","map":{"version":3,"sources":["../../../../src/virtualization/services/ScrollerService.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var normalize = function (x) { return Math.max(x, 0); };\n/**\n * @hidden\n */\nvar ScrollAction = /** @class */ (function () {\n    function ScrollAction(offset) {\n        this.offset = offset;\n    }\n    return ScrollAction;\n}());\nexport { ScrollAction };\n/**\n * @hidden\n */\nvar PageAction = /** @class */ (function () {\n    function PageAction(skip) {\n        this.skip = skip;\n    }\n    return PageAction;\n}());\nexport { PageAction };\n/**\n * @hidden\n */\nvar ScrollerService = /** @class */ (function () {\n    function ScrollerService(onScrollAction, onPageAction) {\n        this.onScrollAction = onScrollAction;\n        this.onPageAction = onPageAction;\n        this.firstLoaded = 0;\n        this.bottomOffset = 0;\n        this.topOffset = 0;\n    }\n    ScrollerService.prototype.create = function (rowHeightService, skip, take, total, topOffset, bottomOffset, direction) {\n        if (topOffset === void 0) { topOffset = 0; }\n        if (bottomOffset === void 0) { bottomOffset = 0; }\n        if (direction === void 0) { direction = 'vertical'; }\n        this.rowHeightService = rowHeightService;\n        this.firstLoaded = skip;\n        this.lastLoaded = skip + take;\n        this.take = take;\n        this.total = total;\n        this.lastScrollTop = 0;\n        this.topOffset = topOffset;\n        this.bottomOffset = bottomOffset;\n        this.direction = direction;\n        var offsetBufferRows = this.rowsForHeight(topOffset);\n        var skipWithOffset = normalize(skip - offsetBufferRows);\n        this.onScrollAction(new ScrollAction(this.rowOffset(skipWithOffset)));\n        this.onPageAction(new PageAction(skipWithOffset));\n    };\n    ScrollerService.prototype.onScroll = function (_a) {\n        var scrollLeft = _a.scrollLeft, scrollTop = _a.scrollTop, offsetHeight = _a.offsetHeight, offsetWidth = _a.offsetWidth;\n        var scrollPosition = this.direction === 'vertical' ? scrollTop : scrollLeft;\n        var offsetSize = this.direction === 'vertical' ? offsetHeight : offsetWidth;\n        if (this.lastScrollTop === scrollPosition) {\n            return;\n        }\n        var up = this.lastScrollTop >= scrollPosition;\n        this.lastScrollTop = scrollPosition;\n        var firstItemIndex = this.rowHeightService.index(normalize(scrollPosition - this.topOffset));\n        var lastItemIndex = this.rowHeightService.index(normalize(scrollPosition + offsetSize - this.bottomOffset));\n        if (!up && lastItemIndex >= this.lastLoaded && this.lastLoaded < this.total) {\n            this.firstLoaded = firstItemIndex;\n            this.onScrollAction(new ScrollAction(this.rowOffset(firstItemIndex)));\n            this.lastLoaded = Math.min(this.firstLoaded + this.take, this.total);\n            this.onPageAction(new PageAction(this.firstLoaded));\n        }\n        if (up && firstItemIndex <= this.firstLoaded) {\n            var nonVisibleBuffer = Math.floor(this.take * 0.3);\n            this.firstLoaded = normalize(firstItemIndex - nonVisibleBuffer);\n            this.onScrollAction(new ScrollAction(this.rowOffset(this.firstLoaded)));\n            this.lastLoaded = Math.min(this.firstLoaded + this.take, this.total);\n            this.onPageAction(new PageAction(this.firstLoaded));\n        }\n    };\n    ScrollerService.prototype.rowOffset = function (index) {\n        return this.rowHeightService.offset(index) + this.topOffset;\n    };\n    ScrollerService.prototype.rowsForHeight = function (height) {\n        return Math.ceil(height / this.rowHeightService.height(0));\n    };\n    return ScrollerService;\n}());\nexport { ScrollerService };\n//# sourceMappingURL=ScrollerService.js.map"]},"metadata":{},"sourceType":"module"}
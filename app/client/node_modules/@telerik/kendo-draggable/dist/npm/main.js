'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var proxy = function (a, b) { return function (e) { return b(a(e)); }; };

var bind = function (el, event, callback) { return el.addEventListener && el.addEventListener(event, callback); };

var unbind = function (el, event, callback) { return el && el.removeEventListener && el.removeEventListener(event, callback); };

var noop = function () { /* empty */ };

var preventDefault = function (e) { return e.preventDefault(); };

var touchRegExp = /touch/;

// 300ms is the usual mouse interval;
// // However, an underpowered mobile device under a heavy load may queue mouse events for a longer period.
var IGNORE_MOUSE_TIMEOUT = 2000;

function normalizeEvent(e) {
    if (e.type.match(touchRegExp)) {
        return {
            pageX: e.changedTouches[0].pageX,
            pageY: e.changedTouches[0].pageY,
            clientX: e.changedTouches[0].clientX,
            clientY: e.changedTouches[0].clientY,
            type: e.type,
            originalEvent: e,
            isTouch: true
        };
    }

    return {
        pageX: e.pageX,
        pageY: e.pageY,
        clientX: e.clientX,
        clientY: e.clientY,
        offsetX: e.offsetX,
        offsetY: e.offsetY,
        type: e.type,
        ctrlKey: e.ctrlKey,
        shiftKey: e.shiftKey,
        altKey: e.altKey,
        originalEvent: e
    };
}

var Draggable = function Draggable(ref) {
    var this$1 = this;
    var press = ref.press; if ( press === void 0 ) press = noop;
    var drag = ref.drag; if ( drag === void 0 ) drag = noop;
    var release = ref.release; if ( release === void 0 ) release = noop;
    var mouseOnly = ref.mouseOnly; if ( mouseOnly === void 0 ) mouseOnly = false;

    this._pressHandler = proxy(normalizeEvent, press);
    this._dragHandler = proxy(normalizeEvent, drag);
    this._releaseHandler = proxy(normalizeEvent, release);
    this._ignoreMouse = false;
    this._mouseOnly = mouseOnly;

    this._touchstart = function (e) {
        if (e.touches.length === 1) {
            this$1._pressHandler(e);
        }
    };

    this._touchmove = function (e) {
        if (e.touches.length === 1) {
            this$1._dragHandler(e);
        }
    };

    this._touchend = function (e) {
        // the last finger has been lifted, and the user is not doing gesture.
        // there might be a better way to handle this.
        if (e.touches.length === 0 && e.changedTouches.length === 1) {
            this$1._releaseHandler(e);
            this$1._ignoreMouse = true;
            setTimeout(this$1._restoreMouse, IGNORE_MOUSE_TIMEOUT);
        }
    };

    this._restoreMouse = function () {
        this$1._ignoreMouse = false;
    };

    this._mousedown = function (e) {
        var which = e.which;

        if ((which && which > 1) || this$1._ignoreMouse) {
            return;
        }

        bind(document, "mousemove", this$1._mousemove);
        bind(document, "mouseup", this$1._mouseup);
        this$1._pressHandler(e);
    };

    this._mousemove = function (e) {
        this$1._dragHandler(e);
    };

    this._mouseup = function (e) {
        unbind(document, "mousemove", this$1._mousemove);
        unbind(document, "mouseup", this$1._mouseup);
        this$1._releaseHandler(e);
    };

    this._pointerdown = function (e) {
        if (e.isPrimary && e.button === 0) {
            bind(document, "pointermove", this$1._pointermove);
            bind(document, "pointerup", this$1._pointerup);
            bind(document, "pointercancel", this$1._pointerup);
            bind(document, "contextmenu", preventDefault);

            this$1._pressHandler(e);
        }
    };

    this._pointermove = function (e) {
        if (e.isPrimary) {
            this$1._dragHandler(e);
        }
    };

    this._pointerup = function (e) {
        if (e.isPrimary) {
            unbind(document, "pointermove", this$1._pointermove);
            unbind(document, "pointerup", this$1._pointerup);
            unbind(document, "pointercancel", this$1._pointerup);
            unbind(document, "contextmenu", preventDefault);

            this$1._releaseHandler(e);
        }
    };
};

Draggable.supportPointerEvent = function supportPointerEvent () {
    return (typeof window !== 'undefined') && window.PointerEvent;
};

Draggable.prototype.bindTo = function bindTo (element) {
    if (element === this._element) {
        return;
    }

    if (this._element) {
        this._unbindFromCurrent();
    }

    this._element = element;
    this._bindToCurrent();
};

Draggable.prototype._bindToCurrent = function _bindToCurrent () {
    var element = this._element;

    if (this._usePointers()) {
        bind(element, "pointerdown", this._pointerdown);
        return;
    }

    bind(element, "mousedown", this._mousedown);

    if (!this._mouseOnly) {
        bind(element, "touchstart", this._touchstart);
        bind(element, "touchmove", this._touchmove);
        bind(element, "touchend", this._touchend);
    }
};

Draggable.prototype._unbindFromCurrent = function _unbindFromCurrent () {
    var element = this._element;

    if (this._usePointers()) {
        unbind(element, "pointerdown", this._pointerdown);
        unbind(document, "pointermove", this._pointermove);
        unbind(document, "pointerup", this._pointerup);
        unbind(document, "contextmenu", preventDefault);
        unbind(document, "pointercancel", this._pointerup);
        return;
    }

    unbind(element, "mousedown", this._mousedown);

    if (!this._mouseOnly) {
        unbind(element, "touchstart", this._touchstart);
        unbind(element, "touchmove", this._touchmove);
        unbind(element, "touchend", this._touchend);
    }
};

Draggable.prototype._usePointers = function _usePointers () {
    return !this._mouseOnly && Draggable.supportPointerEvent();
};

Draggable.prototype.update = function update (ref) {
        var press = ref.press; if ( press === void 0 ) press = noop;
        var drag = ref.drag; if ( drag === void 0 ) drag = noop;
        var release = ref.release; if ( release === void 0 ) release = noop;
        var mouseOnly = ref.mouseOnly; if ( mouseOnly === void 0 ) mouseOnly = false;

    this._pressHandler = proxy(normalizeEvent, press);
    this._dragHandler = proxy(normalizeEvent, drag);
    this._releaseHandler = proxy(normalizeEvent, release);
    this._mouseOnly = mouseOnly;
};

Draggable.prototype.destroy = function destroy () {
    this._unbindFromCurrent();
    this._element = null;
};

// Re-export as "default" field to address a bug
// where the ES Module is imported by CommonJS code.
//
// See https://github.com/telerik/kendo-angular/issues/1314
Draggable.default = Draggable;

exports.Draggable = Draggable;
exports['default'] = Draggable;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9yb290L3NyYy9naXRodWIuY29tL3RlbGVyaWsva2VuZG8tZHJhZ2dhYmxlL3NyYy9tYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHByb3h5ID0gKGEsIGIpID0+IChlKSA9PiBiKGEoZSkpO1xuXG5jb25zdCBiaW5kID0gKGVsLCBldmVudCwgY2FsbGJhY2spID0+XG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lciAmJiBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7XG5cbmNvbnN0IHVuYmluZCA9IChlbCwgZXZlbnQsIGNhbGxiYWNrKSA9PlxuICAgIGVsICYmIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2spO1xuXG5jb25zdCBub29wID0gKCkgPT4geyAvKiBlbXB0eSAqLyB9O1xuXG5jb25zdCBwcmV2ZW50RGVmYXVsdCA9IGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5jb25zdCB0b3VjaFJlZ0V4cCA9IC90b3VjaC87XG5cbi8vIDMwMG1zIGlzIHRoZSB1c3VhbCBtb3VzZSBpbnRlcnZhbDtcbi8vIC8vIEhvd2V2ZXIsIGFuIHVuZGVycG93ZXJlZCBtb2JpbGUgZGV2aWNlIHVuZGVyIGEgaGVhdnkgbG9hZCBtYXkgcXVldWUgbW91c2UgZXZlbnRzIGZvciBhIGxvbmdlciBwZXJpb2QuXG5jb25zdCBJR05PUkVfTU9VU0VfVElNRU9VVCA9IDIwMDA7XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUV2ZW50KGUpIHtcbiAgICBpZiAoZS50eXBlLm1hdGNoKHRvdWNoUmVnRXhwKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGFnZVg6IGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgsXG4gICAgICAgICAgICBwYWdlWTogZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxcbiAgICAgICAgICAgIGNsaWVudFg6IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCxcbiAgICAgICAgICAgIGNsaWVudFk6IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSxcbiAgICAgICAgICAgIHR5cGU6IGUudHlwZSxcbiAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQ6IGUsXG4gICAgICAgICAgICBpc1RvdWNoOiB0cnVlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZVg6IGUucGFnZVgsXG4gICAgICAgIHBhZ2VZOiBlLnBhZ2VZLFxuICAgICAgICBjbGllbnRYOiBlLmNsaWVudFgsXG4gICAgICAgIGNsaWVudFk6IGUuY2xpZW50WSxcbiAgICAgICAgb2Zmc2V0WDogZS5vZmZzZXRYLFxuICAgICAgICBvZmZzZXRZOiBlLm9mZnNldFksXG4gICAgICAgIHR5cGU6IGUudHlwZSxcbiAgICAgICAgY3RybEtleTogZS5jdHJsS2V5LFxuICAgICAgICBzaGlmdEtleTogZS5zaGlmdEtleSxcbiAgICAgICAgYWx0S2V5OiBlLmFsdEtleSxcbiAgICAgICAgb3JpZ2luYWxFdmVudDogZVxuICAgIH07XG59XG5cbmV4cG9ydCBjbGFzcyBEcmFnZ2FibGUge1xuICAgIHN0YXRpYyBzdXBwb3J0UG9pbnRlckV2ZW50KCkge1xuICAgICAgICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSAmJiB3aW5kb3cuUG9pbnRlckV2ZW50O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHsgcHJlc3MgPSBub29wLCBkcmFnID0gbm9vcCwgcmVsZWFzZSA9IG5vb3AsIG1vdXNlT25seSA9IGZhbHNlIH0pIHtcbiAgICAgICAgdGhpcy5fcHJlc3NIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHByZXNzKTtcbiAgICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIgPSBwcm94eShub3JtYWxpemVFdmVudCwgZHJhZyk7XG4gICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIHJlbGVhc2UpO1xuICAgICAgICB0aGlzLl9pZ25vcmVNb3VzZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9tb3VzZU9ubHkgPSBtb3VzZU9ubHk7XG5cbiAgICAgICAgdGhpcy5fdG91Y2hzdGFydCA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ByZXNzSGFuZGxlcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90b3VjaG1vdmUgPSAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmFnSGFuZGxlcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90b3VjaGVuZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAvLyB0aGUgbGFzdCBmaW5nZXIgaGFzIGJlZW4gbGlmdGVkLCBhbmQgdGhlIHVzZXIgaXMgbm90IGRvaW5nIGdlc3R1cmUuXG4gICAgICAgICAgICAvLyB0aGVyZSBtaWdodCBiZSBhIGJldHRlciB3YXkgdG8gaGFuZGxlIHRoaXMuXG4gICAgICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMCAmJiBlLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyKGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2lnbm9yZU1vdXNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHRoaXMuX3Jlc3RvcmVNb3VzZSwgSUdOT1JFX01PVVNFX1RJTUVPVVQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3Jlc3RvcmVNb3VzZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2lnbm9yZU1vdXNlID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fbW91c2Vkb3duID0gKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgd2hpY2ggfSA9IGU7XG5cbiAgICAgICAgICAgIGlmICgod2hpY2ggJiYgd2hpY2ggPiAxKSB8fCB0aGlzLl9pZ25vcmVNb3VzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYmluZChkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgdGhpcy5fbW91c2Vtb3ZlKTtcbiAgICAgICAgICAgIGJpbmQoZG9jdW1lbnQsIFwibW91c2V1cFwiLCB0aGlzLl9tb3VzZXVwKTtcbiAgICAgICAgICAgIHRoaXMuX3ByZXNzSGFuZGxlcihlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl9tb3VzZW1vdmUgPSAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIoZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fbW91c2V1cCA9IChlKSA9PiB7XG4gICAgICAgICAgICB1bmJpbmQoZG9jdW1lbnQsIFwibW91c2Vtb3ZlXCIsIHRoaXMuX21vdXNlbW92ZSk7XG4gICAgICAgICAgICB1bmJpbmQoZG9jdW1lbnQsIFwibW91c2V1cFwiLCB0aGlzLl9tb3VzZXVwKTtcbiAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyKGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3BvaW50ZXJkb3duID0gKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmlzUHJpbWFyeSAmJiBlLmJ1dHRvbiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGJpbmQoZG9jdW1lbnQsIFwicG9pbnRlcm1vdmVcIiwgdGhpcy5fcG9pbnRlcm1vdmUpO1xuICAgICAgICAgICAgICAgIGJpbmQoZG9jdW1lbnQsIFwicG9pbnRlcnVwXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICAgICAgYmluZChkb2N1bWVudCwgXCJwb2ludGVyY2FuY2VsXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICAgICAgYmluZChkb2N1bWVudCwgXCJjb250ZXh0bWVudVwiLCBwcmV2ZW50RGVmYXVsdCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVzc0hhbmRsZXIoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fcG9pbnRlcm1vdmUgPSAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUuaXNQcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fcG9pbnRlcnVwID0gKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmlzUHJpbWFyeSkge1xuICAgICAgICAgICAgICAgIHVuYmluZChkb2N1bWVudCwgXCJwb2ludGVybW92ZVwiLCB0aGlzLl9wb2ludGVybW92ZSk7XG4gICAgICAgICAgICAgICAgdW5iaW5kKGRvY3VtZW50LCBcInBvaW50ZXJ1cFwiLCB0aGlzLl9wb2ludGVydXApO1xuICAgICAgICAgICAgICAgIHVuYmluZChkb2N1bWVudCwgXCJwb2ludGVyY2FuY2VsXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICAgICAgdW5iaW5kKGRvY3VtZW50LCBcImNvbnRleHRtZW51XCIsIHByZXZlbnREZWZhdWx0KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VIYW5kbGVyKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGJpbmRUbyhlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50ID09PSB0aGlzLl9lbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fdW5iaW5kRnJvbUN1cnJlbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLl9iaW5kVG9DdXJyZW50KCk7XG4gICAgfVxuXG4gICAgX2JpbmRUb0N1cnJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuXG4gICAgICAgIGlmICh0aGlzLl91c2VQb2ludGVycygpKSB7XG4gICAgICAgICAgICBiaW5kKGVsZW1lbnQsIFwicG9pbnRlcmRvd25cIiwgdGhpcy5fcG9pbnRlcmRvd24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgYmluZChlbGVtZW50LCBcIm1vdXNlZG93blwiLCB0aGlzLl9tb3VzZWRvd24pO1xuXG4gICAgICAgIGlmICghdGhpcy5fbW91c2VPbmx5KSB7XG4gICAgICAgICAgICBiaW5kKGVsZW1lbnQsIFwidG91Y2hzdGFydFwiLCB0aGlzLl90b3VjaHN0YXJ0KTtcbiAgICAgICAgICAgIGJpbmQoZWxlbWVudCwgXCJ0b3VjaG1vdmVcIiwgdGhpcy5fdG91Y2htb3ZlKTtcbiAgICAgICAgICAgIGJpbmQoZWxlbWVudCwgXCJ0b3VjaGVuZFwiLCB0aGlzLl90b3VjaGVuZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdW5iaW5kRnJvbUN1cnJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuXG4gICAgICAgIGlmICh0aGlzLl91c2VQb2ludGVycygpKSB7XG4gICAgICAgICAgICB1bmJpbmQoZWxlbWVudCwgXCJwb2ludGVyZG93blwiLCB0aGlzLl9wb2ludGVyZG93bik7XG4gICAgICAgICAgICB1bmJpbmQoZG9jdW1lbnQsIFwicG9pbnRlcm1vdmVcIiwgdGhpcy5fcG9pbnRlcm1vdmUpO1xuICAgICAgICAgICAgdW5iaW5kKGRvY3VtZW50LCBcInBvaW50ZXJ1cFwiLCB0aGlzLl9wb2ludGVydXApO1xuICAgICAgICAgICAgdW5iaW5kKGRvY3VtZW50LCBcImNvbnRleHRtZW51XCIsIHByZXZlbnREZWZhdWx0KTtcbiAgICAgICAgICAgIHVuYmluZChkb2N1bWVudCwgXCJwb2ludGVyY2FuY2VsXCIsIHRoaXMuX3BvaW50ZXJ1cCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB1bmJpbmQoZWxlbWVudCwgXCJtb3VzZWRvd25cIiwgdGhpcy5fbW91c2Vkb3duKTtcblxuICAgICAgICBpZiAoIXRoaXMuX21vdXNlT25seSkge1xuICAgICAgICAgICAgdW5iaW5kKGVsZW1lbnQsIFwidG91Y2hzdGFydFwiLCB0aGlzLl90b3VjaHN0YXJ0KTtcbiAgICAgICAgICAgIHVuYmluZChlbGVtZW50LCBcInRvdWNobW92ZVwiLCB0aGlzLl90b3VjaG1vdmUpO1xuICAgICAgICAgICAgdW5iaW5kKGVsZW1lbnQsIFwidG91Y2hlbmRcIiwgdGhpcy5fdG91Y2hlbmQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VzZVBvaW50ZXJzKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuX21vdXNlT25seSAmJiBEcmFnZ2FibGUuc3VwcG9ydFBvaW50ZXJFdmVudCgpO1xuICAgIH1cblxuICAgIHVwZGF0ZSh7IHByZXNzID0gbm9vcCwgZHJhZyA9IG5vb3AsIHJlbGVhc2UgPSBub29wLCBtb3VzZU9ubHkgPSBmYWxzZSB9KSB7XG4gICAgICAgIHRoaXMuX3ByZXNzSGFuZGxlciA9IHByb3h5KG5vcm1hbGl6ZUV2ZW50LCBwcmVzcyk7XG4gICAgICAgIHRoaXMuX2RyYWdIYW5kbGVyID0gcHJveHkobm9ybWFsaXplRXZlbnQsIGRyYWcpO1xuICAgICAgICB0aGlzLl9yZWxlYXNlSGFuZGxlciA9IHByb3h5KG5vcm1hbGl6ZUV2ZW50LCByZWxlYXNlKTtcbiAgICAgICAgdGhpcy5fbW91c2VPbmx5ID0gbW91c2VPbmx5O1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX3VuYmluZEZyb21DdXJyZW50KCk7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICAgIH1cbn1cblxuLy8gUmUtZXhwb3J0IGFzIFwiZGVmYXVsdFwiIGZpZWxkIHRvIGFkZHJlc3MgYSBidWdcbi8vIHdoZXJlIHRoZSBFUyBNb2R1bGUgaXMgaW1wb3J0ZWQgYnkgQ29tbW9uSlMgY29kZS5cbi8vXG4vLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3RlbGVyaWsva2VuZG8tYW5ndWxhci9pc3N1ZXMvMTMxNFxuRHJhZ2dhYmxlLmRlZmF1bHQgPSBEcmFnZ2FibGU7XG5cbi8vIFJvbGx1cCB3b24ndCBvdXRwdXQgZXhwb3J0c1snZGVmYXVsdCddIG90aGVyd2lzZVxuZXhwb3J0IGRlZmF1bHQgRHJhZ2dhYmxlO1xuXG4iXSwibmFtZXMiOlsiY29uc3QiLCJ0aGlzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUFBLElBQU0sS0FBSyxHQUFHLFVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxTQUFHLFVBQUMsQ0FBQyxFQUFFLFNBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFBLENBQUM7O0FBRXZDQSxJQUFNLElBQUksR0FBRyxVQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQy9CLEVBQUUsQ0FBQyxnQkFBZ0IsSUFBSSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFBLENBQUM7O0FBRWhFQSxJQUFNLE1BQU0sR0FBRyxVQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQ2pDLEVBQUUsSUFBSSxFQUFFLENBQUMsbUJBQW1CLElBQUksRUFBRSxDQUFDLG1CQUFtQixDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBQSxDQUFDOztBQUU1RUEsSUFBTSxJQUFJLEdBQUcsWUFBRyxlQUFrQixDQUFDOztBQUVuQ0EsSUFBTSxjQUFjLEdBQUcsVUFBQSxDQUFDLEVBQUMsU0FBRyxDQUFDLENBQUMsY0FB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